<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCHAT - Welcome & Account Access</title>

    <!-- Google Fonts: Poppins for headings, Inter for body text -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preconnect to Firebase domains for faster loading -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://*.firebaseio.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">

    <style>
        /* Universal box-sizing for consistent layout */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* Global CSS Variables (consistent with admin_groups.html) */
        :root {
            --pink: #e03a8c; /* Adjusted to match admin_groups.html */
            --blue: #00b8e0; /* Adjusted to match admin_groups.html */
            --gradient-main: linear-gradient(90deg, var(--blue), var(--pink));

            --glass-base: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --radius: 16px; /* Adjusted to match admin_groups.html */
            --transition: 0.4s ease; /* Adjusted to match admin_groups.html */

            --white: #f0f0f0;
            --text-light: #b0b0b0;

            --background-main: #1a1a2e;
            --background-gradient-1: rgba(0, 184, 224, 0.08); /* Adjusted to match admin_groups.html */
            --background-gradient-2: rgba(224, 58, 140, 0.08); /* Adjusted to match admin_groups.html */
            --card-background: rgba(25, 25, 40, 0.6);
            --input-background: rgba(255, 255, 255, 0.08);
            --button-background-gradient: linear-gradient(90deg, var(--blue), var(--pink));
            --button-shadow: 0 6px 20px rgba(0, 184, 224, 0.25), 0 6px 20px rgba(224, 58, 140, 0.25);
            --border-color: rgba(255, 255, 255, 0.08);

            --success-color: #28a745;
            --error-color: #dc3545;
            --info-color: #007bff;
            --warning-color: #ffc107;
        }

        /* Theme Definitions (Light, Dark, Glass, Sunset) - Kept from original Login.html */
        body.theme-light-mode {
            --background-main: #f0f2f5;
            background-image: none !important;
            --white: #333;
            --text-light: rgba(0, 0, 0, .7);
            --card-background: rgba(255, 255, 255, 0.95);
            --header-background: rgba(255, 255, 255, 0.98);
            --border-color: rgba(0, 0, 0, 0.1);
            --input-background: rgba(0, 0, 0, 0.05);
            --button-background-gradient: linear-gradient(90deg, #6dd5ed, #2193b0);
            --button-shadow: 0 4px 15px rgba(109, 213, 237, 0.4), 0 4px 15px rgba(33, 147, 176, 0.4);

            --background-color-primary: #f0f2f5;
            --background-color-secondary: #e0e2e5;
            --header-background-color: #ffffff;
            --footer-background-color: #ffffff;
            --content-background-color: #f7f9fb;
            --card-background-color: #ffffff;
            --text-color-primary: #333333;
            --text-color-secondary: #666666;
            --accent-color: #007bff;
            --accent-color-dark: #0056b3;
            --input-background-color: #f0f0f0;
            --button-background: #e9ecef;
            --button-hover-background: #dee2e6;
            --active-item-background: rgba(0, 123, 255, 0.1);
            --notification-badge-color: #dc3545;
            --status-online: #28a745;
            --status-offline: #6c757d;
            --status-away: #ffc107;
            --delete-button-color: #dc3545;
            --warning-color: #ffc107;
        }

        body.theme-dark-mode {
            --background-main: #1a1a2e;
            background-image: radial-gradient(circle at top left, #16213e, transparent 100px),
                              radial-gradient(circle at bottom right, #0f3460, transparent 150px) !important;
            --white: #e0e0e0;
            --text-light: #a0a0a0;
            --card-background: rgba(25, 25, 40, 0.7);
            --header-background: linear-gradient(135deg, rgba(10, 10, 20, .85), rgba(10, 10, 20, .75));
            --border-color: rgba(255, 255, 255, 0.08);
            --input-background: rgba(255, 255, 255, 0.08);
            --button-background-gradient: linear-gradient(90deg, #e94560, #ba2f49);
            --button-shadow: 0 4px 15px rgba(233, 69, 96, 0.4), 0 4px 15px rgba(186, 47, 73, 0.4);

            --background-color-primary: #121212;
            --background-color-secondary: #1e1e1e;
            --header-background-color: #2c2c2c;
            --footer-background-color: #2c2c2c;
            --content-background-color: #242424;
            --card-background-color: #2c2c2c;
            --text-color-primary: #ffffff;
            --text-color-secondary: #bbbbbb;
            --accent-color: #bb86fc;
            --accent-color-dark: #9a67ea;
            --input-background-color: #383838;
            --button-background: #383838;
            --button-hover-background: #505050;
            --active-item-background: rgba(187, 134, 252, 0.2);
            --notification-badge-color: #cf6679;
            --delete-button-color: #f44336;
            --warning-color: #ffeb3b;
        }

        body.theme-glass-mode {
            --background-main: rgba(10, 10, 10, 0.75);
            background-image: url('https://source.unsplash.com/random/1920x1080?abstract,blur') !important;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            backdrop-filter: blur(10px);
            --card-background: rgba(25, 25, 40, 0.7);
            --white: #e0e0e0;
            --text-light: rgba(255, 255, 255, 0.7);
            --input-background: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --button-background-gradient: linear-gradient(90deg, var(--pink), var(--blue));
            --button-shadow: 0 4px 15px var(--blue), 0 4px 15px var(--pink);
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.5);

            --background-color-primary: rgba(10, 10, 10, 0.75);
            --background-color-secondary: rgba(10, 10, 10, 0.6);
            --header-background-color: rgba(10, 10, 10, 0.85);
            --footer-background-color: rgba(10, 10, 10, 0.85);
            --content-background-color: rgba(10, 10, 10, 0.75);
            --card-background-color: rgba(25, 25, 40, 0.7);
            --text-color-primary: #e0e0e0;
            --text-color-secondary: #b0b0d0;
            --accent-color: #00d5ff;
            --accent-color-dark: #00aaff;
            --input-background-color: rgba(255, 255, 255, 0.05);
            --button-background: rgba(0, 213, 255, 0.15);
            --button-hover-background: rgba(0, 213, 255, 0.25);
            --active-item-background: rgba(0, 213, 255, 0.1);
        }

        body.theme-sunset-mode {
            background: linear-gradient(to top, #ff7e5f, #feb47b) !important;
            --background-main: linear-gradient(to top, #ff7e5f, #feb47b);
            --card-background: rgba(255, 255, 255, 0.15);
            --white: #fff;
            --text-light: rgba(255, 255, 255, 0.8);
            --input-background: rgba(255, 255, 255, 0.1);
            --border-color: rgba(255, 255, 255, 0.3);
            --button-background-gradient: linear-gradient(90deg, #fd746c, #ff9068);
            --button-shadow: 0 4px 15px rgba(253, 116, 108, 0.4), 0 4px 15px rgba(255, 144, 104, 0.4);

            --background-color-primary: #ff7e5f;
            --background-color-secondary: #feb47b;
            --header-background-color: rgba(255, 126, 95, 0.9);
            --footer-background-color: rgba(255, 126, 95, 0.9);
            --content-background-color: rgba(255, 126, 95, 0.85);
            --card-background-color: rgba(255, 255, 255, 0.15);
            --text-color-primary: #fff;
            --text-color-secondary: rgba(255, 255, 255, 0.8);
            --accent-color: #ffd700;
            --accent-color-dark: #ccaa00;
            --input-background-color: rgba(255, 255, 255, 0.2);
            --button-background: rgba(255, 255, 255, 0.2);
            --button-hover-background: rgba(255, 255, 255, 0.3);
            --active-item-background: rgba(255, 215, 0, 0.1);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars on main body for transitions */
        }

        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--background-main);
            background-image: radial-gradient(circle at top left, var(--background-gradient-1), transparent 100px),
                              radial-gradient(circle at bottom right, var(--background-gradient-2), transparent 150px);
            color: var(--white);
            transition: background-color 0.5s ease, color 0.5s ease;
            position: relative; /* For positioning message box */
        }

        /* --- Header Styles --- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            background: var(--header-background);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            font-weight: 800;
            background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            letter-spacing: -0.03em;
            text-decoration: none;
        }

        /* --- Welcome Screen Styles (Contains About Us content) --- */
        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--background-main);
            background-image: radial-gradient(circle at top left, var(--background-gradient-1), transparent 100px),
                              radial-gradient(circle at bottom right, var(--background-gradient-2), transparent 150px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            z-index: 100; /* Above auth container initially */
            padding: 20px;
            text-align: center;
        }

        .welcome-screen.active {
            opacity: 1;
            visibility: visible;
        }

        .welcome-content {
            max-width: 800px;
            width: 100%;
            max-height: calc(100vh - 180px); /* Adjust based on header/footer space for scrolling */
            overflow-y: auto; /* Enable vertical scrolling */
            padding-right: 15px; /* Space for scrollbar */
            padding-bottom: 20px;
            margin-bottom: 20px;
            background: var(--card-background); /* Card background for the content area */
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            box-shadow: 0 8px 25px rgba(0, 0, 0, .3);
            padding: 2.5rem;
            text-align: left; /* Align text left within content */
            position: relative; /* For scroll-to-top button positioning */
        }

        .welcome-content::-webkit-scrollbar {
            width: 8px;
        }

        .welcome-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .welcome-content::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--blue), var(--pink));
            border-radius: 10px;
        }

        .welcome-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--pink), var(--blue));
        }

        /* About Page Specific Styles (integrated and adapted) */
        .welcome-content h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            margin-bottom: 1.5rem;
            text-align: center; /* Center the main title */
        }

        .welcome-content h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid var(--border-color);
            padding-bottom: 0.75rem;
        }

        .welcome-content h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .welcome-content p {
            font-size: 1.1rem;
            color: var(--white);
            line-height: 1.6;
            margin-bottom: 1rem;
            text-align: justify; /* Justify text for body paragraphs */
        }

        .welcome-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--white);
        }

        .welcome-content ul li {
            margin-bottom: 0.5rem;
            color: var(--white);
        }

        .welcome-content .profile-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 50%;
            border: 5px solid var(--blue);
            box-shadow: 0 5px 15px rgba(0, 184, 224, 0.25), 0 5px 15px rgba(224, 58, 140, 0.25);
            transition: transform var(--transition), border-color var(--transition);
            margin: 0 auto 1.5rem auto;
            display: block;
        }

        .welcome-content .profile-image:hover {
            transform: scale(1.08);
            border-color: var(--pink);
        }

        .welcome-content .skill-tag {
            display: inline-block;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            margin: 0.4rem;
            transition: background var(--transition), transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .welcome-content .skill-tag:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .welcome-content .separator {
            width: 80%;
            height: 2px;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            margin: 3rem auto;
            border-radius: 1px;
            opacity: 0.7;
        }

        .welcome-content .support-details {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .welcome-content .support-details h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .welcome-content .support-details p {
            margin-bottom: 0.5rem;
            font-size: 1rem;
            color: var(--white);
            text-align: center;
        }

        .welcome-content .support-details p strong {
            color: var(--blue);
        }

        .welcome-content .support-details a {
            color: var(--blue);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .welcome-content .support-details a:hover {
            color: var(--pink);
        }
        .welcome-content .contact-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 1.1rem;
            color: var(--white);
        }

        .welcome-content .contact-item i {
            color: var(--pink);
            font-size: 1.2rem;
        }

        .get-started-button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            background: var(--button-background-gradient);
            color: var(--white);
            box-shadow: var(--button-shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .get-started-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        /* Scroll to Top Button */
        #scrollToTopBtn {
            position: absolute; /* Position relative to .welcome-content */
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--blue), var(--pink));
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
            z-index: 10;
        }

        #scrollToTopBtn.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(-5px);
        }

        #scrollToTopBtn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        /* --- Auth Container Styles --- */
        .auth-container {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px) saturate(180%);
            border-radius: var(--radius);
            box-shadow: 0 8px 25px rgba(0, 0, 0, .3);
            padding: 2.5rem;
            width: 90%;
            max-width: 450px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            z-index: 90;
        }

        .auth-container.active {
            opacity: 1;
            visibility: visible;
        }

        .auth-container h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            margin-bottom: 1.5rem;
        }

        .form-group {
            width: 100%;
            text-align: left;
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--input-background);
            color: var(--text-color-primary);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 213, 255, 0.2);
        }

        .auth-button {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            background: var(--button-background-gradient);
            color: var(--white);
            box-shadow: var(--button-shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .auth-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .toggle-form-link {
            margin-top: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-light);
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s ease;
        }

        .toggle-form-link:hover {
            color: var(--white);
        }

        .forgot-password-link {
            font-size: 0.9em;
            color: var(--text-light);
            text-decoration: none;
            margin-top: -10px;
            margin-bottom: 10px;
            display: block;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .forgot-password-link:hover {
            color: var(--white);
        }

        /* Separator for social login */
        .separator {
            margin: 25px 0;
            color: var(--text-light);
            position: relative;
            font-size: 0.9rem;
        }

        .separator::before,
        .separator::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: var(--border-color);
        }

        .separator::before {
            left: 0;
        }

        .separator::after {
            right: 0;
        }

        .social-login-button {
            background-color: var(--input-background);
            color: var(--text-color-primary);
            border: 1px solid var(--border-color);
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .social-login-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .social-login-button i {
            font-size: 1.2rem;
        }

        .button-text { display: block; }
        .loading .button-text { display: none; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom Message Box Styles */
        #messageBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-background-color);
            color: var(--text-color-primary);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            min-width: 280px;
            max-width: 90%;
            text-align: center;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        #messageBox.show {
            opacity: 1;
            display: flex;
        }
        #messageBox.success {
            background-image: linear-gradient(45deg, var(--pink), var(--blue));
            color: var(--white);
            border: none;
            box-shadow: 0 8px 30px rgba(0, 213, 255, 0.5), 0 8px 30px rgba(255, 46, 146, 0.5);
        }
        #messageBox.error { border-left: 5px solid var(--delete-button-color); background-color: var(--card-background-color); color: var(--text-color-primary); }
        #messageBox.info { border-left: 5px solid var(--accent-color); background-color: var(--card-background-color); color: var(--text-color-primary); }
        #messageBox.warning { border-left: 5px solid var(--warning-color); background-color: var(--card-background-color); color: var(--text-color-primary); }

        #messageBox i {
            font-size: 2.5rem;
            margin-bottom: 5px;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }
        #messageBox.success i { color: var(--white); }
        #messageBox.error i { color: var(--delete-button-color); }
        #messageBox.info i { color: var(--accent-color); }
        #messageBox.warning i { color: var(--warning-color); }

        #messageBox span {
            font-size: 1.1rem;
            font-weight: 600;
        }

        @keyframes pulse-bg {
            0% { background-color: var(--accent-color); }
            50% { background-color: rgba(0, 213, 255, 0.7); }
            100% { background-color: var(--accent-color); }
        }
        #messageBox.loading-pulse { animation: pulse-bg 1.5s infinite ease-in-out; }

        /* Referral bonus text style */
        .referral-bonus-text {
            font-size: 0.9em;
            color: var(--text-light);
            margin-top: -10px;
            margin-bottom: 10px;
            display: block;
        }
        .referral-bonus-text .highlight {
            background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--blue), var(--pink));
            font-weight: 600;
        }

        /* New: JCHAT Features Section Styles */
        .jchat-features-section {
            width: 100%;
            margin-top: 2rem;
            background: var(--card-background);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px) saturate(180%);
            border-radius: var(--radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .jchat-features-header {
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }

        .jchat-features-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .jchat-features-header h2 {
            margin: 0;
            font-size: 1.5rem;
            border-bottom: none;
            padding-bottom: 0;
            background-image: linear-gradient(90deg, var(--pink), var(--blue)); /* Pink to Blue gradient for header h2 */
        }

        .jchat-features-header i {
            font-size: 1.2rem;
            color: var(--blue); /* Blue for the chevron icon */
            transition: transform 0.3s ease;
        }

        .jchat-features-header.expanded i {
            transform: rotate(180deg);
            color: var(--pink); /* Pink when expanded */
        }

        .jchat-features-content {
            max-height: 0;
            overflow-y: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
            padding: 0 1.5rem;
        }

        .jchat-features-content.expanded {
            max-height: 500px; /* Adjust as needed for content height */
            overflow-y: auto;
            padding: 1.5rem;
        }

        .jchat-features-content::-webkit-scrollbar {
            width: 6px;
        }

        .jchat-features-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .jchat-features-content::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--blue), var(--pink));
            border-radius: 10px;
        }
        .jchat-features-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--pink), var(--blue));
        }

        /* Adjustments for nested headings/paragraphs/lists within .jchat-features-content */
        .jchat-features-content h3 {
            font-size: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            border-bottom: none;
            padding-bottom: 0;
            background-image: var(--gradient-main); /* Blue to Pink gradient for content h3 */
        }
        .jchat-features-content p {
            font-size: 1rem;
            margin-bottom: 0.8rem;
            color: var(--text-light); /* Lighter text for features content */
        }
        .jchat-features-content ul {
            list-style: none; /* Remove default disc */
            padding: 0;
            margin-left: 0;
        }
        .jchat-features-content ul li {
            font-size: 0.95rem;
            margin-bottom: 0.6rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            color: var(--white); /* White text for list items */
        }
        .jchat-features-content ul li i {
            font-size: 1.1rem;
            color: var(--blue); /* Blue for list item icons */
            margin-top: 3px;
        }
        .jchat-features-content ul li span.gradient-text {
            background-image: linear-gradient(90deg, var(--blue), var(--pink)); /* Gradient for highlighted text in lists */
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            font-weight: 600;
        }

        /* Responsive Adjustments */
        @media (max-width: 600px) {
            .welcome-screen h1 {
                font-size: 2.5rem;
            }
            .welcome-screen h2 {
                font-size: 1.8rem;
            }
            .welcome-screen h3 {
                font-size: 1.3rem;
            }
            .welcome-content p, .welcome-content ul li {
                font-size: 0.9rem;
            }
            .welcome-content ul li i {
                font-size: 1rem;
            }
            .welcome-content .profile-image {
                width: 150px;
                height: 150px;
            }
            .welcome-content .skill-tag {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            .welcome-content .support-details {
                padding: 1rem;
            }
            .welcome-content .support-details h3 {
                font-size: 1.2rem;
            }
            .welcome-content .support-details p {
                font-size: 0.85rem;
            }
            .get-started-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            .auth-container {
                padding: 1.5rem;
                gap: 1rem;
            }
            .auth-container h1 {
                font-size: 2.2rem;
                margin-bottom: 1rem;
            }
            .form-group {
                margin-bottom: 0.8rem;
            }
            .form-group label {
                font-size: 0.9rem;
            }
            .form-group input {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            .auth-button {
                padding: 12px 15px;
                font-size: 1rem;
            }
            .toggle-form-link, .forgot-password-link {
                font-size: 0.85rem;
                margin-top: 1rem;
            }
            #messageBox {
                padding: 15px 20px;
                font-size: 1rem;
            }
            #messageBox i {
                font-size: 2rem;
            }
            #messageBox span {
                font-size: 1rem;
            }

            .jchat-features-header h2 {
                font-size: 1.2rem;
            }
            .jchat-features-content p {
                font-size: 0.85rem;
            }
            .jchat-features-content ul li {
                font-size: 0.8rem;
            }
            .jchat-features-content ul li i {
                font-size: 0.9rem;
            }

            #scrollToTopBtn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                bottom: 15px;
                right: 15px;
            }
        }
    </style>

    </head>
<body class="theme-dark-mode">

    <header>
        <a href="#" class="logo">JCHAT</a>
    </header>

    <main>
        <!-- Welcome Screen (Initial view, contains About Us content) -->
        <div id="welcomeScreen" class="welcome-screen">
            <div class="welcome-content">
                <h1>About JCHAT Founder & Builder</h1>
                <div class="flex justify-center mb-6">
                    <!-- Your profile picture -->
                    <img src="admin2.png" alt="Profile Picture of JCHAT Founder & Builder" class="profile-image"
                         onerror="this.onerror=null;this.src='https://placehold.co/200x200/1a1a2e/f0f0f0?text=Elechi';">
                </div>
                <p class="text-xl text-white font-medium text-center">
                    Passionate about technology, community, and making a positive impact. ‚ú®
                </p>

                <!-- Section: The JCHAT Genesis: A Dream for Everyone -->
                <section class="section-card">
                    <h2>The JCHAT Genesis: A Dream for Everyone üåç</h2>
                    <p>
                        My name is Elechi Osoundu Joshua, and I come from a humble background in **Ebonyi State, Ezza South, Onicha Local Government, Nigeria**. As the first son and third child in my family, I learned early on the value of hard work and finding smart solutions. Growing up, I always dreamed of making things easier for people, especially when it came to connecting and sharing.
                    </p>
                    <p>
                        This dream wasn't just about building another app; it was about creating a space where everyone could communicate smoothly and feel truly valued. The unique part? **I built JCHAT from scratch, entirely from my own ideas and effort, without anyone else's help or input.** It was a journey fueled by pure passion and a clear vision. That's why JCHAT was born! I wanted to build a platform where connecting with friends, managing groups, and sharing moments felt natural and rewarding. And yes, that includes the unique part about **offering earning opportunities** üí∞ to our users. It's my way of giving back to the amazing community that helps JCHAT grow.
                    </p>
                </section>

                <!-- Section: Building JCHAT: My Expertise in Action -->
                <section class="section-card">
                    <h2>Building JCHAT: My Expertise in Action üõ†Ô∏è</h2>
                    <p>
                        My professional journey has been all about building and managing software projects in the tech world. I've been lucky to work on many different things, but creating JCHAT has been where I've truly put my skills to the test. **Every line of code, every feature, every design choice in JCHAT comes directly from my mind and hands.** It's a testament to what dedication and a clear vision can achieve.
                    </p>
                    <p>
                        My role at JCHAT involves keeping everything running smoothly, making the user experience better, and adding new features that our community will love. I'm dedicated to making JCHAT not just a good app, but a reliable and enjoyable one for everyone. This also means making sure our earning features are fair and simple to understand. ‚úÖ
                    </p>
                    <h3>Key Skills:</h3>
                    <div class="flex flex-wrap">
                        <span class="skill-tag">Web Development (HTML, CSS, JavaScript)</span>
                        <span class="skill-tag">Frontend Frameworks (React, Vue.js)</span>
                        <span class="skill-tag">Backend Development (Node.js, Python)</span>
                        <span class="skill-tag">Database Management (SQL, NoSQL)</span>
                        <span class="skill-tag">Cloud Platforms (AWS, GCP)</span>
                        <span class="skill-tag">UI/UX Design Principles</span>
                        <span class="skill-tag">Project Management</span>
                        <span class="skill-tag">Agile Methodologies</span>
                        <span class="skill-tag">Technical Troubleshooting</span>
                        <span class="skill-tag">API Integration</span>
                        <span class="skill-tag">Data Analysis</span>
                        <span class="skill-tag">Community Building</span>
                    </div>
                </section>

                <!-- Section: Beyond the Code -->
                <section class="section-card">
                    <h2>Beyond the Code üå≥</h2>
                    <p>
                        While I love building technology, I also believe in a balanced life. When I'm not coding, you'll often find me:
                    </p>
                    <ul>
                        <li><strong>Exploring Nature:</strong> Hiking new trails or just enjoying a quiet moment outdoors helps me relax and see things from a fresh perspective. üèûÔ∏è</li>
                        <li><strong>Creative Pursuits:</strong> I enjoy digital art and photography. It's a great way to unwind and express ideas visually. üé®üì∏</li>
                        <li><strong>Learning New Things:</strong> I love the challenge of learning new languages, both human ones and programming languages. It opens up new ways of thinking. üìö</li>
                        <li><strong>Community Volunteering:</strong> Giving back, especially in areas like digital education or protecting our environment, is very important to me. üôè</li>
                        <li><strong>Reading & Research:</strong> My bookshelves are full of different books, from exciting sci-fi to the latest in AI and future tech. üß†</li>
                    </ul>
                    <p>
                        These activities aren't just hobbies; they help spark new ideas and improve my problem-solving skills, which I often bring back to JCHAT.
                    </p>
                </section>

                <!-- Section: The Future of JCHAT: Empowering Every User -->
                <section class="section-card">
                    <h2>The Future of JCHAT: Empowering Every User ‚ú®</h2>
                    <p>
                        My main belief is in always getting better and seeing every challenge as a chance to grow. This thinking was key when I created JCHAT, especially in making it powerful yet simple for everyone. I always try to work with a positive attitude, a team spirit, and a commitment to doing my best. This ensures JCHAT is not only useful but also fair, welcoming, and built to last.
                    </p>
                    <p>
                        Looking ahead, my main goal is to keep making JCHAT better for you, our users. This means adding more ways to earn, introducing even simpler features, and making sure JCHAT stays a truly easy and rewarding place to connect. I'm excited to explore new ideas in communication, accessible tech, and smart AI, all to make your JCHAT experience even better.
                    </p>
                    <p>
                        **Building JCHAT has been a labor of love, a solo journey from concept to reality.** To truly unlock its full potential and bring even more groundbreaking ideas to life ‚Äì ideas that will further empower and benefit our community ‚Äì **financial support is crucial.** Your contribution can help us scale, innovate, and create something truly greater than what you see today. üöÄ
                    </p>

                    <div class="support-details">
                        <h3>Support JCHAT's Growth</h3>
                        <p>Every contribution, big or small, helps us build a better future for JCHAT.</p>
                        <p class="contact-item"><i class="fas fa-envelope"></i> Email: <a href="mailto:jchatguide@gmail.com">jchatguide@gmail.com</a></p>
                        <p class="contact-item"><i class="fab fa-whatsapp"></i> WhatsApp: <a href="https://wa.me/2349013790707">+234 901 379 0707</a></p>
                        <p style="margin-top: 15px;">
                            <strong>Local Bank for User Support:</strong><br>
                            <strong>Bank Name:</strong> Opay<br>
                            <strong>Account Number:</strong> 8111609765<br>
                            <strong>Account Name:</strong> Elechi Joshua
                        </p>
                    </div>
                </section>
                <div class="separator"></div>
                <footer>
                    <p>Designed with passion and a dash of code.</p>
                    <p>&copy; 2025 Elechi Osoundu Joshua. All rights reserved.</p>
                </footer>
            </div>
            <button id="getStartedButton" class="get-started-button">
                <span class="button-text"><i class="fas fa-arrow-right"></i> Get Started</span>
            </button>
            <!-- Scroll to Top Button -->
            <button id="scrollToTopBtn" aria-label="Scroll to top">
                <i class="fas fa-arrow-up"></i>
            </button>
        </div>

        <!-- Auth Container (Hidden initially, appears after "Get Started") -->
        <div id="authContainer" class="auth-container">
            <h1 id="authTitle">Login to JCHAT</h1>

            <!-- Login Form -->
            <form id="loginForm" style="display: block;">
                <div class="form-group">
                    <label for="loginEmail">Email:</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password:</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <a href="#" class="forgot-password-link" id="showResetPasswordLink">Forgot Password?</a>
                <button type="submit" id="loginButton" class="auth-button">
                    <span class="button-text"><i class="fas fa-sign-in-alt"></i> Login</span>
                    
                </button>
                <div class="separator">OR</div>
                <button class="social-login-button" id="googleLoginButton">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
                <p class="toggle-form-link" id="showRegisterLink">Don't have an account? Register here.</p>
            </form>

            <!-- Register Form -->
            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerUsername">Username:</label>
                    <input type="text" id="registerUsername" placeholder="Choose a username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email:</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password:</label>
                    <input type="password" id="registerPassword" placeholder="Choose a password (min 6 chars)" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="referralCode">Referral Code (Optional):</label>
                    <input type="text" id="referralCode" placeholder="Enter code if you have one">
                    <span class="referral-bonus-text">
                        New users with a code get <span class="highlight">5 JCoins</span> & <span class="highlight">5 XP</span>!
                    </span>
                </div>
                <button type="submit" id="registerButton" class="auth-button">
                    <span class="button-text"><i class="fas fa-user-plus"></i> Register</span>
                    
                </button>
                <div class="separator">OR</div>
                <button class="social-login-button" id="googleRegisterButton">
                    <i class="fab fa-google"></i> Sign up with Google
                </button>
                <p class="toggle-form-link" id="showLoginLinkFromRegister">Already have an account? Login here.</p>
            </form>

            <!-- Reset Password Form -->
            <form id="resetPasswordForm" style="display: none;">
                <p style="color: var(--text-light); font-size: 0.95rem; margin-bottom: 20px;">
                    Enter your email address and we'll send you a link to reset your password.
                </p>
                <div class="form-group">
                    <label for="resetEmail">Email:</label>
                    <input type="email" id="resetEmail" placeholder="Enter your email" required autocomplete="email">
                </div>
                <button type="submit" id="sendResetEmailButton" class="auth-button">
                    <span class="button-text"><i class="fas fa-envelope"></i> Send Reset Link</span>
                    
                </button>
                <p class="toggle-form-link" id="backToLoginLink">Back to Login</p>
            </form>

            <!-- New: Discover JCHAT Features Section -->
            <div class="jchat-features-section">
                <div class="jchat-features-header" id="featuresHeader">
                    <h2>Discover JCHAT Features <i class="fas fa-chevron-down"></i></h2>
                </div>
                <div class="jchat-features-content" id="featuresContent">
                    <!-- Content from previous Welcome Screen goes here -->
                    <!-- Real-time Communication -->
                    <h3><span class="gradient-text">Real-time Communication at Your Fingertips</span></h3>
                    <p>
                        Experience instant and fluid conversations with friends and groups. JCHAT offers a robust messaging platform designed for both one-on-one chats and large community discussions.
                    </p>
                    <ul>
                        <li><i class="fas fa-paper-plane"></i> <span class="gradient-text">Instant Messaging:</span> Send text messages, emojis, and GIFs in real-time.</li>
                        <li><i class="fas fa-image"></i> <span class="gradient-text">Rich Media Sharing:</span> Easily share photos, videos, and voice notes to express yourself fully.</li>
                        <li><i class="fas fa-phone-alt"></i> <span class="gradient-text">Voice & Video Calls:</span> Connect with friends face-to-face or voice-to-voice with crystal-clear quality (feature coming soon!).</li>
                    </ul>

                    <!-- Build Your Community -->
                    <h3><span class="gradient-text">Build Your Community, Your Way</span></h3>
                    <p>
                        Whether you're looking for a close-knit circle or a sprawling public forum, JCHAT provides the tools to build and manage communities that resonate with your interests.
                    </p>
                    <ul>
                        <li><i class="fas fa-users"></i> <span class="gradient-text">Dynamic Group Chats:</span> Create or join communities based on shared hobbies, passions, or professional networks.</li>
                        <li><i class="fas fa-user-plus"></i> <span class="gradient-text">Friend Management:</span> Easily find, add, and manage your friends, ensuring you stay connected with those who matter most.</li>
                        <li><i class="fas fa-globe"></i> <span class="gradient-text">Public & Private Groups:</span> Discover public groups to explore new interests or create private ones for exclusive conversations.</li>
                        <li><i class="fas fa-rss"></i> <span class="gradient-text">Social Feed:</span> Share updates, photos, and thoughts with your friends and followers in a personalized social feed.</li>
                    </ul>

                    <!-- Gamified Experience & Rewards -->
                    <h3><span class="gradient-text">Gamified Experience & Rewards</span></h3>
                    <p>
                        JCHAT makes every interaction rewarding! Engage with the app and earn valuable in-app currency and experience points.
                    </p>
                    <ul>
                        <li><i class="fas fa-coins"></i> <span class="gradient-text">JCoins & Gas (XP):</span> Earn JCoins, our versatile in-app currency, and Gas (Experience Points) for your daily activities.</li>
                        <li><i class="fas fa-calendar-check"></i> <span class="gradient-text">Daily Check-ins:</span> Get bonus JCoins and XP just for logging in each day.</li>
                        <li><i class="fas fa-trophy"></i> <span class="gradient-text">Active Quests:</span> Complete exciting challenges like sending messages or interacting with content to earn significant rewards.</li>
                        <li><i class="fas fa-chart-line"></i> <span class="gradient-text">Level Up System:</span> Gain XP to level up, unlock new titles, and climb the global leaderboards to showcase your dedication.</li>
                        <li><i class="fas fa-gift"></i> <span class="gradient-text">Referral Program:</span> Invite your friends to JCHAT and both you and your friend receive bonus JCoins and XP upon their successful registration!</li>
                    </ul>

                    <!-- Powerful Group Features -->
                    <h3><span class="gradient-text">Powerful Group Features</span></h3>
                    <p>
                        For group administrators, JCHAT offers a suite of tools to manage and enhance their communities, making them more engaging and visible.
                    </p>
                    <ul>
                        <li><i class="fas fa-bullhorn"></i> <span class="gradient-text">Group Promotion:</span> Boost your group's visibility in the "Discover Groups" section to attract new members.</li>
                        <li><i class="fas fa-palette"></i> <span class="gradient-text">Exclusive Customization:</span> Unlock unique themes, banners, and visual elements to personalize your group's appearance.</li>
                        <li><i class="fas fa-rocket"></i> <span class="gradient-text">Temporary Group Boosts:</span> Activate XP or JCoin boosts for all members within your group to accelerate their progress.</li>
                        <li><i class="fas fa-calendar-alt"></i> <span class="gradient-text">Special Group Events:</span> Host exclusive activities, contests, or JCoin payouts for your members (feature coming soon!).</li>
                        <li><i class="fas fa-hand-holding-usd"></i> <span class="gradient-text">Group Vault & Donations:</span> Members can donate JCoins to a shared group vault, empowering admins to invest in group features.</li>
                    </ul>

                    <!-- Your Personalized JCHAT Experience -->
                    <h3><span class="gradient-text">Your Personalized JCHAT Experience</span></h3>
                    <p>
                        Tailor JCHAT to fit your style and preferences.
                    </p>
                    <ul>
                        <li><i class="fas fa-user-circle"></i> <span class="gradient-text">Profile Customization:</span> Personalize your profile with a unique picture, bio, and privacy settings.</li>
                        <li><i class="fas fa-wallet"></i> <span class="gradient-text">Secure Wallet:</span> Manage your JCoins and track all your transactions transparently.</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Custom Message Box -->
    <div id="messageBox"></div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // Corrected import for Auth specific functions, including GoogleAuthProvider
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, sendPasswordResetEmail, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        // Correct Firestore imports
        import { getFirestore, doc, setDoc, collection, query, where, getDocs, runTransaction, serverTimestamp, increment, updateDoc, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- Firebase & Canvas Environment Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyBsBinyrD9WZZXRaCvA4gxfX7BIimydDvo",
            authDomain: "jchat-1.firebaseapp.com",
            projectId: "jchat-1",
            storageBucket: "jchat-1.firebasestorage.app",
            messagingSenderId: "328479683167",
            appId: "1:328479683167:web:276c0b7e8ea44dd2d6a1ea",
            measurementId: "G-S6Z9GG0R9P"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase services
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // --- DOM Elements ---
        const welcomeScreen = document.getElementById('welcomeScreen');
        const getStartedButton = document.getElementById('getStartedButton');
        const authContainer = document.getElementById('authContainer');
        const welcomeContent = document.querySelector('.welcome-content'); // Get the scrollable content div
        const scrollToTopBtn = document.getElementById('scrollToTopBtn'); // Get the new scroll-to-top button

        const authTitle = document.getElementById('authTitle');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const resetPasswordForm = document.getElementById('resetPasswordForm');

        // Login Elements
        const loginEmailInput = document.getElementById('loginEmail');
        const loginPasswordInput = document.getElementById('loginPassword');
        const loginButton = document.getElementById('loginButton');
        const googleLoginButton = document.getElementById('googleLoginButton');
        const showRegisterLink = document.getElementById('showRegisterLink');
        const showResetPasswordLink = document.getElementById('showResetPasswordLink');

        // Register Elements
        const registerUsernameInput = document.getElementById('registerUsername');
        const registerEmailInput = document.getElementById('registerEmail');
        const registerPasswordInput = document.getElementById('registerPassword');
        const referralCodeInput = document.getElementById('referralCode');
        const registerButton = document.getElementById('registerButton');
        const googleRegisterButton = document.getElementById('googleRegisterButton');
        const showLoginLinkFromRegister = document.getElementById('showLoginLinkFromRegister');

        // Reset Password Elements
        const resetEmailInput = document.getElementById('resetEmail');
        const sendResetEmailButton = document.getElementById('sendResetEmailButton');
        const backToLoginLink = document.getElementById('backToLoginLink');

        const messageBox = document.getElementById('messageBox');

        // New: Features Section Toggle Elements
        const featuresHeader = document.getElementById('featuresHeader');
        const featuresContent = document.getElementById('featuresContent');

        // --- Constants for Referral Rewards ---
        const REFERRAL_JCOIN_REWARD_NEW_USER = 5;
        const REFERRAL_XP_REWARD_NEW_USER = 5;
        const REFERRAL_JCOIN_REWARD_REFERRER = 10;
        const REFERRAL_XP_REWARD_REFERRER = 5;

        // --- Utility Functions ---

        /**
         * Displays a temporary message box with a given message and type.
         * @param {string} message - The message to display.
         * @param {string} type - The type of message ('success', 'error', 'info', 'loading', 'warning').
         * @param {number} [durationMs=3000] - Duration in milliseconds for the message to display.
         * @param {boolean} [isPersistent=false] - If true, message stays until explicitly cleared or replaced.
         */
        function showMessageBox(message, type, durationMs = 3000, isPersistent = false) {
            if (messageBox.timeoutId) {
                clearTimeout(messageBox.timeoutId);
                messageBox.timeoutId = null;
            }

            messageBox.innerHTML = `<i id="messageBoxIcon"></i><span id="messageBoxText"></span>`;
            const messageBoxIcon = messageBox.querySelector('#messageBoxIcon');
            const messageBoxText = messageBox.querySelector('#messageBoxText');

            messageBoxText.textContent = message;
            messageBox.className = 'message-box show ' + type;

            if (messageBoxIcon) {
                if (type === 'success') {
                    messageBoxIcon.classList.add('fas', 'fa-check-circle');
                } else if (type === 'error') {
                    messageBoxIcon.classList.add('fas', 'fa-times-circle');
                } else if (type === 'info') {
                    messageBoxIcon.classList.add('fas', 'fa-info-circle');
                } else if (type === 'warning') {
                    messageBoxIcon.classList.add('fas', 'fa-exclamation-triangle');
                } else if (type === 'loading') {
                    messageBoxIcon.classList.add('fas', 'fa-spinner', 'fa-spin');
                }
            }

            if (type === 'loading') {
                messageBox.classList.add('loading-pulse');
            } else {
                messageBox.classList.remove('loading-pulse');
            }

            messageBox.style.display = 'flex';
            messageBox.style.opacity = '1';

            if (!isPersistent) {
                messageBox.timeoutId = setTimeout(() => {
                    messageBox.style.opacity = '0';
                    messageBox.addEventListener('transitionend', function handler() {
                        messageBox.style.display = 'none';
                        messageBox.removeEventListener('transitionend', handler);
                        messageBox.classList.remove('loading-pulse');
                    }, { once: true });
                }, durationMs);
            }
        }

        /**
         * Toggles loading state for a button.
         * @param {HTMLElement} buttonElement - The button to toggle.
         * @param {boolean} isLoading - True to show loading, false to hide.
         */
        function toggleButtonLoading(buttonElement, isLoading) {
            if (!buttonElement) return;
            
            const text = buttonElement.querySelector('.button-text');

            if (isLoading) {
                buttonElement.disabled = true;
                buttonElement.classList.add('loading');
                
                if (text) text.style.display = 'none';
            } else {
                buttonElement.disabled = false;
                buttonElement.classList.remove('loading');
                
                if (text) text.style.display = 'block';
            }
        }

        /**
         * Generates a random alphanumeric referral code.
         * @param {number} length - The desired length of the referral code.
         * @returns {string} The generated referral code.
         */
        function generateReferralCode(length = 8) {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        /**
         * Creates a pending activity reward for admin review.
         * @param {string} userId - The ID of the user whose JCoins/XP/Gas are affected.
         * @param {string} username - The username of the user.
         * @param {string} activityType - Type of activity (e.g., 'referral_bonus').
         * @param {number} suggestedJCoinAmount - The suggested JCoin amount (positive for add, negative for deduct).
         * @param {number} suggestedXpAmount - The suggested XP amount (positive for add, negative for deduct).
         * @param {number} suggestedGasAmount - The suggested Gas amount (positive for add, negative for deduct).
         * @param {string|null} groupId - The ID of the group involved, if any.
         * @param {string|null} relatedEntityId - ID of related entity (e.g., referrer ID, new user ID).
         */
        async function createPendingActivityReward(userId, username, activityType, suggestedJCoinAmount, suggestedXpAmount, suggestedGasAmount, groupId = null, relatedEntityId = null) {
            try {
                const pendingRewardsCollectionRef = collection(db, "artifacts", appId, "public", "data", "pending_activity_rewards");
                await addDoc(pendingRewardsCollectionRef, {
                    userId: userId,
                    username: username,
                    activityType: activityType,
                    suggestedJCoinAmount: suggestedJCoinAmount,
                    suggestedXpAmount: suggestedXpAmount,
                    suggestedGasAmount: suggestedGasAmount,
                    status: 'pending', // Always pending for admin review
                    timestamp: serverTimestamp(),
                    groupId: groupId,
                    relatedEntityId: relatedEntityId,
                    reviewerId: null, // Admin who reviews it
                    reviewTimestamp: null,
                    notes: ''
                });
                console.log(`JCHAT_DEBUG: Pending activity reward created for ${activityType}.`);
            } catch (error) {
                console.error("JCHAT_ERROR: Error creating pending activity reward:", error);
            }
        }

        // --- Authentication Functions ---

        /**
         * Handles user login.
         */
        async function handleLogin(event) {
            event.preventDefault();
            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value.trim();

            if (!email || !password) {
                showMessageBox("Please enter both email and password.", "warning");
                return;
            }

            toggleButtonLoading(loginButton, true);
            showMessageBox("Logging in...", "loading", true);

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessageBox("Login successful! Redirecting...", "success");
                setTimeout(() => {
                    window.location.href = '/Home.html';
                }, 1000);
            } catch (error) {
                console.error("Login error:", error);
                let errorMessage = "Login failed. Please check your email and password.";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMessage = "Invalid email or password.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email format.";
                }
                showMessageBox(errorMessage, "error");
            } finally {
                toggleButtonLoading(loginButton, false);
            }
        }

        /**
         * Handles new user registration.
         */
        async function handleRegister(event) {
            event.preventDefault();
            const username = registerUsernameInput.value.trim();
            const email = registerEmailInput.value.trim();
            const password = registerPasswordInput.value.trim();
            const referralCode = referralCodeInput.value.trim().toUpperCase(); // Convert to uppercase for consistency

            if (!username || !email || !password) {
                showMessageBox("Please fill in all required fields.", "warning");
                return;
            }
            if (password.length < 6) {
                showMessageBox("Password must be at least 6 characters long.", "warning");
                return;
            }

            toggleButtonLoading(registerButton, true);
            showMessageBox("Registering...", "loading", true);

            try {
                // 1. Create user with email and password
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // 2. Update user profile (display name)
                await updateProfile(user, { displayName: username });

                let referrerId = null;
                let referrerUsername = null;

                // 3. Check and validate referral code if provided
                if (referralCode) {
                    const referrerQuery = query(collection(db, "artifacts", appId, "users"), where("profiles.user_profile.referralCode", "==", referralCode));
                    const referrerSnapshot = await getDocs(referrerQuery);

                    if (!referrerSnapshot.empty) {
                        const referrerDoc = referrerSnapshot.docs[0];
                        referrerId = referrerDoc.id;
                        referrerUsername = referrerDoc.data().profiles.user_profile.username || `User_${referrerDoc.id.substring(0, 8)}`;
                        console.log(`JCHAT_DEBUG: Referral code found. Referrer ID: ${referrerId}, Username: ${referrerUsername}`);
                    } else {
                        showMessageBox("Invalid referral code. Registering without referral bonus.", "warning", 4000);
                        // Do not return, allow registration to proceed without referral bonus
                    }
                }

                // 4. Create user profile in Firestore and apply bonuses via transaction
                await runTransaction(db, async (transaction) => {
                    const userProfileRef = doc(db, "artifacts", appId, "users", user.uid, "profiles", "user_profile");
                    const userTransactionsCollectionRef = collection(db, "artifacts", appId, "users", user.uid, "transactions");

                    let newUserJCoins = 0;
                    let newUserGas = 0;
                    let newUserDescription = "New user registration.";

                    if (referrerId) {
                        // Apply bonus for new user if referred
                        newUserJCoins = REFERRAL_JCOIN_REWARD_NEW_USER;
                        newUserGas = REFERRAL_XP_REWARD_NEW_USER;
                        newUserDescription = `New user registration (via referral code: ${referralCode}).`;
                    }

                    // Set new user's private profile
                    transaction.set(userProfileRef, {
                        username: username,
                        email: email,
                        profilePicId: null, // User can set later
                        bio: "", location: "", friendsCount: 0, followersCount: 0, followingCount: 0,
                        createdAt: serverTimestamp(), updatedAt: serverTimestamp(),
                        inspirationType: "motivational",
                        visibility: {
                            displayName: true, profilePic: true, bio: false, location: false,
                            emailPublic: false, lastOnline: false, allowFriendRequests: true, allowMessages: true,
                        },
                        totalPosts: 0,
                        jCoins: newUserJCoins,
                        gas: newUserGas,
                        level: 1, // Initial level
                        currentXp: newUserGas, // Current XP starts with initial gas
                        xpToNextLevel: 100, // XP needed for level 2 (placeholder, adjust in getLevelInfo)
                        messagesSentCount: 0,
                        lastGroupCheckIn: null,
                        completedQuests: [],
                        questProgress: {},
                        referralCode: generateReferralCode(), // Generate new referral code for this user
                        successfulReferrals: 0,
                        walletUnlocked: true // Wallet is unlocked by default for new users
                    });

                    // Set new user's public profile (for leaderboard/display)
                    const userPublicProfileRef = doc(db, "artifacts", appId, "public", "data", "users", user.uid);
                    transaction.set(userPublicProfileRef, {
                        username: username,
                        profilePicId: null,
                        jCoins: newUserJCoins,
                        level: 1,
                        userId: user.uid,
                        email: email,
                        messagesSentCount: 0
                    });

                    // Add transaction for new user's initial bonus (if applicable)
                    if (newUserJCoins > 0 || newUserGas > 0) {
                        transaction.set(doc(userTransactionsCollectionRef), {
                            type: 'initial_bonus',
                            amount: newUserJCoins,
                            xpAmount: newUserGas,
                            description: newUserDescription,
                            timestamp: serverTimestamp(),
                            relatedEntityId: referrerId // Link to referrer if exists
                        });
                    }

                    // If referral code was valid, update referrer's profile
                    if (referrerId) {
                        const referrerProfileRef = doc(db, "artifacts", appId, "users", referrerId, "profiles", "user_profile");
                        const referrerTransactionsCollectionRef = collection(db, "artifacts", appId, "users", referrerId, "transactions");
                        const referrerPublicProfileRef = doc(db, "artifacts", appId, "public", "data", "users", referrerId);

                        const referrerDoc = await transaction.get(referrerProfileRef);
                        const referrerPublicDoc = await transaction.get(referrerPublicProfileRef);

                        if (referrerDoc.exists() && referrerPublicDoc.exists()) {
                            transaction.update(referrerProfileRef, {
                                jCoins: increment(REFERRAL_JCOIN_REWARD_REFERRER),
                                gas: increment(REFERRAL_XP_REWARD_REFERRER),
                                successfulReferrals: increment(1),
                                updatedAt: serverTimestamp()
                            });

                            // Update referrer's public profile for leaderboard/display
                            transaction.update(referrerPublicProfileRef, {
                                jCoins: increment(REFERRAL_JCOIN_REWARD_REFERRER),
                                updatedAt: serverTimestamp()
                            });

                            // Add transaction for referrer's bonus
                            transaction.set(doc(referrerTransactionsCollectionRef), {
                                type: 'referral_bonus',
                                amount: REFERRAL_JCOIN_REWARD_REFERRER,
                                xpAmount: REFERRAL_XP_REWARD_REFERRER,
                                description: `Referral bonus for new user: ${username}`,
                                timestamp: serverTimestamp(),
                                relatedEntityId: user.uid // Link to the new user
                            });
                        }
                    }
                });

                // 5. Create pending activity rewards for admin review (for logging purposes)
                if (referrerId) {
                    // For the new user's bonus
                    await createPendingActivityReward(
                        user.uid,
                        username,
                        'new_user_referral_bonus',
                        REFERRAL_JCOIN_REWARD_NEW_USER,
                        REFERRAL_XP_REWARD_NEW_USER,
                        0, // Assuming Gas is XP
                        null,
                        referrerId
                    );
                    // For the referrer's bonus
                    await createPendingActivityReward(
                        referrerId,
                        referrerUsername,
                        'referrer_referral_bonus',
                        REFERRAL_JCOIN_REWARD_REFERRER,
                        REFERRAL_XP_REWARD_REFERRER,
                        0, // Assuming Gas is XP
                        null,
                        user.uid
                    );
                }

                showMessageBox("Registration successful! Redirecting...", "success");
                setTimeout(() => {
                    window.location.href = '/Home.html';
                }, 1000);

            } catch (error) {
                console.error("Registration error:", error);
                let errorMessage = "Registration failed. Please try again.";
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "Email already in use. Please use a different email or login.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email format.";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "Password is too weak. Please choose a stronger password.";
                }
                showMessageBox(errorMessage, "error");
            } finally {
                toggleButtonLoading(registerButton, false);
            }
        }

        /**
         * Handles sending a password reset email.
         */
        async function handlePasswordReset(event) {
            event.preventDefault();
            const email = resetEmailInput.value.trim();

            if (!email) {
                showMessageBox("Please enter your email address.", "warning");
                return;
            }

            toggleButtonLoading(sendResetEmailButton, true);
            showMessageBox("Sending password reset email...", "loading", true);

            try {
                await sendPasswordResetEmail(auth, email);
                showMessageBox("Password reset email sent! Check your inbox.", "success", 5000);
                resetEmailInput.value = ''; // Clear input
                // Transition back to login form after success
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                resetPasswordForm.style.display = 'none';
                authTitle.textContent = 'Login to JCHAT';
            } catch (error) {
                console.error("Password reset error:", error);
                let errorMessage = "Failed to send password reset email. Please try again.";
                if (error.code === 'auth/user-not-found') {
                    errorMessage = "No user found with that email address.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email format.";
                }
                showMessageBox(errorMessage, "error");
            } finally {
                toggleButtonLoading(sendResetEmailButton, false);
            }
        }

        /**
         * Handles Google Sign-In/Registration.
         */
        async function handleGoogleAuth(type) {
            const button = type === 'login' ? googleLoginButton : googleRegisterButton;
            toggleButtonLoading(button, true);
            showMessageBox(`Signing ${type === 'login' ? 'in' : 'up'} with Google...`, "loading", true);

            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;

                const userProfileRef = doc(db, "artifacts", appId, "users", user.uid, "profiles", "user_profile");
                const userDocSnap = await getDoc(userProfileRef);

                if (!userDocSnap.exists()) {
                    // New user, create profile
                    let username = user.displayName || user.email.split('@')[0];
                    // You might want to ask for a referral code here if it's a new Google signup
                    // For simplicity, we'll assume no referral for Google signups for now, or you can prompt
                    await runTransaction(db, async (transaction) => {
                        transaction.set(userProfileRef, {
                            username: username,
                            email: user.email,
                            profilePicId: user.photoURL || null,
                            bio: "", location: "", friendsCount: 0, followersCount: 0, followingCount: 0,
                            createdAt: serverTimestamp(), updatedAt: serverTimestamp(),
                            inspirationType: "motivational",
                            visibility: {
                                displayName: true, profilePic: true, bio: false, location: false,
                                emailPublic: false, lastOnline: false, allowFriendRequests: true, allowMessages: true,
                            },
                            totalPosts: 0,
                            jCoins: REFERRAL_JCOIN_REWARD_NEW_USER, // Google new user gets initial JCoins
                            gas: REFERRAL_XP_REWARD_NEW_USER, // Google new user gets initial XP
                            level: 1,
                            currentXp: REFERRAL_XP_REWARD_NEW_USER,
                            xpToNextLevel: 100,
                            messagesSentCount: 0,
                            lastGroupCheckIn: null,
                            completedQuests: [],
                            questProgress: {},
                            referralCode: generateReferralCode(),
                            successfulReferrals: 0,
                            walletUnlocked: true
                        });
                        // Set new user's public profile
                        const userPublicProfileRef = doc(db, "artifacts", appId, "public", "data", "users", user.uid);
                        transaction.set(userPublicProfileRef, {
                            username: username,
                            profilePicId: user.photoURL || null,
                            jCoins: REFERRAL_JCOIN_REWARD_NEW_USER,
                            level: 1,
                            userId: user.uid,
                            email: user.email,
                            messagesSentCount: 0
                        });
                    });
                    showMessageBox("Account created with Google! Redirecting...", "success");
                } else {
                    showMessageBox("Signed in with Google! Redirecting...", "success");
                }

                setTimeout(() => {
                    window.location.href = '/Home.html';
                }, 1000);

            } catch (error) {
                console.error("Google Auth Error:", error);
                let errorMessage = "Google sign-in failed. Please try again.";
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = "Google sign-in window closed.";
                } else if (error.code === 'auth/cancelled-popup-request') {
                    errorMessage = "Another sign-in request is pending.";
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    errorMessage = "An account with this email already exists using different credentials.";
                }
                showMessageBox(errorMessage, "error");
            } finally {
                toggleButtonLoading(button, false);
            }
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            // Apply saved theme
            const savedTheme = localStorage.getItem('jchat-theme');
            const themes = ['theme-light-mode', 'theme-dark-mode', 'theme-glass-mode', 'theme-sunset-mode'];
            if (savedTheme && themes.includes(savedTheme)) {
                document.body.classList.remove(...themes);
                document.body.classList.add(savedTheme);
            } else {
                document.body.classList.add('theme-dark-mode'); // Default to dark mode
            }

            // Check for existing user on page load
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is already logged in, redirect to home
                    console.log("JCHAT_DEBUG: User already logged in, redirecting to home.");
                    window.location.href = '/Home.html';
                } else {
                    // No user logged in, display welcome screen initially
                    console.log("JCHAT_DEBUG: No user logged in. Displaying welcome screen.");
                    welcomeScreen.classList.add('active');
                    authContainer.classList.remove('active');
                }
            });

            // "Get Started" button transitions to auth forms
            getStartedButton.addEventListener('click', () => {
                welcomeScreen.classList.remove('active');
                authContainer.classList.add('active');
                // By default, show login form first
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                resetPasswordForm.style.display = 'none';
                authTitle.textContent = 'Login to JCHAT';
            });

            // Toggle between login and register forms
            showRegisterLink.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                resetPasswordForm.style.display = 'none'; // Ensure reset form is hidden
                registerForm.style.display = 'block';
                authTitle.textContent = 'Join JCHAT';
                messageBox.style.display = 'none'; // Hide message box on form switch
            });

            showLoginLinkFromRegister.addEventListener('click', (e) => {
                e.preventDefault();
                registerForm.style.display = 'none';
                resetPasswordForm.style.display = 'none'; // Ensure reset form is hidden
                loginForm.style.display = 'block';
                authTitle.textContent = 'Login to JCHAT';
                messageBox.style.display = 'none'; // Hide message box on form switch
            });

            // Show reset password form
            showResetPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'none';
                resetPasswordForm.style.display = 'block';
                authTitle.textContent = 'Reset Password';
                messageBox.style.display = 'none'; // Hide message box on form switch
            });

            // Back to login from reset password form
            backToLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                resetPasswordForm.style.display = 'none';
                loginForm.style.display = 'block';
                authTitle.textContent = 'Login to JCHAT';
                messageBox.style.display = 'none'; // Hide message box on form switch
            });

            // Form submissions
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            resetPasswordForm.addEventListener('submit', handlePasswordReset);

            // Social Login Buttons
            googleLoginButton.addEventListener('click', () => handleGoogleAuth('login'));
            googleRegisterButton.addEventListener('click', () => handleGoogleAuth('register'));

            // New: Features Section Toggle
            featuresHeader.addEventListener('click', () => {
                featuresHeader.classList.toggle('expanded');
                featuresContent.classList.toggle('expanded');
            });

            // Scroll to Top Button Logic
            if (welcomeContent && scrollToTopBtn) {
                welcomeContent.addEventListener('scroll', () => {
                    // Show button when scrolled down more than 200px
                    if (welcomeContent.scrollTop > 200) {
                        scrollToTopBtn.classList.add('show');
                    } else {
                        scrollToTopBtn.classList.remove('show');
                    }
                });

                scrollToTopBtn.addEventListener('click', () => {
                    welcomeContent.scrollTo({
                        top: 0,
                        behavior: 'smooth' // Smooth scroll animation
                    });
                });
            }
        });

        // Listen for theme changes from other tabs/windows
        window.addEventListener('storage', (event) => {
            if (event.key === 'jchat-theme') {
                const newTheme = event.newValue || 'theme-dark-mode';
                const themes = ['theme-light-mode', 'theme-dark-mode', 'theme-glass-mode', 'theme-sunset-mode'];
                if (themes.includes(newTheme)) {
                    document.body.classList.remove(...themes);
                    document.body.classList.add(newTheme);
                }
            }
        });
    </script>
</body>
</html>

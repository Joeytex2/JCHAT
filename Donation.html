<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Donate - JCHAT</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <style>
    :root {
      --pink: #ff2e92;
      --blue: #00d5ff;
      --white: #e8ecf1;
      --muted: #a8b0bd;
      --glass-1: rgba(255, 255, 255, 0.06);
      --glass-2: rgba(255, 255, 255, 0.1);
      --border: rgba(255, 255, 255, 0.14);
      --bg: radial-gradient(60rem 60rem at -10% -10%, #0e1631 0%, transparent 60%),
            radial-gradient(60rem 60rem at 110% -10%, #1a0f2b 0%, transparent 60%),
            #0a0c14;
      --accent: linear-gradient(90deg, var(--blue), var(--pink));
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--white);
      min-height: 100vh;
      display: flex; flex-direction: column;
    }
    /* Ambient shapes */
    .blob { position: fixed; filter: blur(80px); opacity: .35; z-index: 0; pointer-events: none; }
    .blob.b1 { width: 42vw; height: 42vw; border-radius: 50%; background: #1b5cff; top: -12vw; left: -8vw; }
    .blob.b2 { width: 38vw; height: 38vw; border-radius: 50%; background: #ff2e92; top: -10vw; right: -6vw; }

    header { position: sticky; top: 0; z-index: 5; background: rgba(6,9,18,0.6); border-bottom: 1px solid var(--border); backdrop-filter: blur(8px); }
    .header-inner { display:flex; align-items:center; justify-content:space-between; gap: 12px; padding: 12px 18px; max-width: 1080px; margin: 0 auto; }
    .back-link { color: var(--white); text-decoration:none; display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--border); border-radius: 10px; background: var(--glass-1); }
    .back-link:hover { background: var(--glass-2); }
    .title { font-family:Poppins, sans-serif; font-weight:800; letter-spacing:-0.02em; background-image: var(--accent); -webkit-background-clip:text; background-clip:text; color: transparent; font-size:1.1rem; }

    main { flex:1; display:flex; align-items:center; justify-content:center; padding: 28px 16px; position: relative; z-index: 1; }

    .shell { width:100%; max-width: 1080px; display:grid; gap: 22px; grid-template-columns: 1fr; }
    @media (min-width: 920px) { .shell { grid-template-columns: 1.2fr 0.8fr; } }

    .card {
      position: relative;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px;
      overflow: hidden;
    }
    .card::before { content:""; position:absolute; inset:0; border-radius: 18px; padding:1px; background: linear-gradient(135deg, var(--blue), var(--pink)); -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events:none; opacity:.35; }

    .section-title { margin: 0 0 4px 0; font-family: Poppins, sans-serif; font-size: 1.35rem; }
    .subtitle { margin: 0 0 16px 0; color: var(--muted); font-size: 0.95rem; }

    .list { display: grid; gap: 12px; }
    .item { display:grid; grid-template-columns: 1fr auto; align-items:center; gap: 10px; padding: 12px; border-radius: 12px; background: var(--glass-1); border: 1px solid var(--border); }
    .label { opacity: .8; font-size: .92rem; }
    .value { font-weight: 700; word-break: break-all; letter-spacing: .2px; }

    .bank-badge { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius: 999px; border:1px solid var(--border); background: var(--glass-1); margin: 6px 0 14px 0; }
    .bank-badge i { color: var(--pink); }

    .actions { display:flex; flex-wrap: wrap; gap:10px; margin-top: 16px; }
    .btn { padding: 10px 14px; border-radius: 12px; border: 1px solid var(--border); color:#fff; background: var(--glass-1); cursor: pointer; transition: .2s transform, .2s filter, .2s background; }
    .btn:hover { transform: translateY(-1px); background: var(--glass-2); }
    .btn.primary { background: var(--accent); border: none; }

    .note { margin-top: 14px; color: var(--muted); font-size: .98rem; line-height: 1.5; }

    /* QR Panel */
    .qr { display:flex; flex-direction:column; gap:18px; }
    .qr-title { font-family:Poppins, sans-serif; font-size: 1.05rem; margin: 0; }
    .qr-box { display:flex; align-items:center; justify-content:center; border-radius:14px; border:1px solid var(--border); background: var(--glass-1); padding:14px; }
    .qr-img { width: 280px; height: 280px; max-width: 60vw; object-fit: contain; border-radius: 10px; background: rgba(0,0,0,.25); }
    .qr-note { color: var(--muted); text-align:center; }

    /* Toast */
    .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(10px); background: #0d1223; color:#fff; border:1px solid var(--border); border-radius: 12px; padding:10px 14px; opacity:0; pointer-events:none; transition:.25s; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <header>
    <div class="header-inner">
      <a class="back-link" href="/Home.html" aria-label="Back to Home"><i class="fas fa-arrow-left"></i><span>Back</span></a>
      <div class="title">Support JCHAT</div>
      <span></span>
    </div>
  </header>
  <main>
    <div class="shell">
      <div class="card">
        <div class="bank-badge"><i class="fas fa-university"></i><span>Verified Bank Details</span></div>
        <h2 class="section-title">Bank Details</h2>
        <p class="subtitle">Use the details below to support development. Thank you!</p>
        <div class="list">
          <div class="item">
            <div class="label">Bank Name</div>
            <div class="value" id="bankName"></div>
            <button class="btn" data-copy="bankName"><i class="fas fa-copy"></i></button>
          </div>
          <div class="item">
            <div class="label">Account Name</div>
            <div class="value" id="accountName"></div>
            <button class="btn" data-copy="accountName"><i class="fas fa-copy"></i></button>
          </div>
          <div class="item">
            <div class="label">Account Number</div>
            <div class="value" id="accountNumber"></div>
            <button class="btn" data-copy="accountNumber"><i class="fas fa-copy"></i></button>
          </div>
          <div class="item">
            <div class="label">SWIFT / IBAN</div>
            <div class="value" id="swift"></div>
            <button class="btn" data-copy="swift"><i class="fas fa-copy"></i></button>
          </div>
        </div>
        <div class="actions">
          <button class="btn" id="shareBtn"><i class="fas fa-share-alt"></i> Share</button>
          <button class="btn primary" id="copyAllBtn"><i class="fas fa-clipboard-check"></i> Copy All</button>
        </div>
        <div class="note" id="donationNote">Your support keeps JCHAT improving for everyone. Every contribution, no matter the amount, helps us maintain servers, build new features, and keep JCHAT free for the community. Thank you for believing in this project.</div>
      </div>
      <div class="card qr" id="qrPanel" style="display:none;">
        <h3 class="qr-title">Quick Donate (QR)</h3>
        <div class="qr-box"><img id="qrImage" class="qr-img" alt="Donation QR" /></div>
        <div class="qr-note" id="qrNote">Scan this code in your banking app to donate instantly.</div>
      </div>
    </div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite">Copied to clipboard</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
      apiKey: "AIzaSyBsBinyrD9WZZXRaCvA4gxfX7BIimydDvo",
      authDomain: "jchat-1.firebaseapp.com",
      projectId: "jchat-1",
      storageBucket: "jchat-1.firebasestorage.app",
      messagingSenderId: "328479683167",
      appId: "1:328479683167:web:276c0b7e8ea44dd2d6a1ea",
      measurementId: "G-S6Z9GG0R9P"
    };
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

    const cloudinaryConfig = {
      cloudName: (typeof __cloudinary_cloud_name !== 'undefined' ? __cloudinary_cloud_name : 'dxld01rcp'),
      uploadPreset: (typeof __cloudinary_upload_preset !== 'undefined' ? __cloudinary_upload_preset : 'Storage_preset')
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const els = {
      bankName: document.getElementById('bankName'),
      accountName: document.getElementById('accountName'),
      accountNumber: document.getElementById('accountNumber'),
      swift: document.getElementById('swift'),
      note: document.getElementById('donationNote'),
      qrPanel: document.getElementById('qrPanel'),
      qrImage: document.getElementById('qrImage'),
      qrNote: document.getElementById('qrNote'),
      toast: document.getElementById('toast')
    };

    function apply(id, val) { if (els[id]) els[id].textContent = val || ''; }

    function showToast(text) {
      if (!els.toast) return;
      els.toast.textContent = text;
      els.toast.classList.add('show');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=> els.toast.classList.remove('show'), 1800);
    }

    function renderQRIfProvided() {
      const pubId = (typeof __donation_qr_public_id !== 'undefined' ? __donation_qr_public_id : '');
      if (!pubId) return;
      if (!els.qrPanel || !els.qrImage) return;
      const url = `https://res.cloudinary.com/${cloudinaryConfig.cloudName}/image/upload/w_520,h_520,c_fit,q_auto,f_auto/${pubId}`;
      els.qrImage.src = url;
      els.qrPanel.style.display = 'block';
    }

    async function loadBankDetails(user) {
      let bank = {};
      if (user) {
        try {
          const profileRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profiles', 'user_profile');
          const snap = await getDoc(profileRef);
          if (snap.exists()) {
            bank = snap.data().bankDetails || {};
          }
        } catch {}
      }
      // Fallbacks
      apply('bankName', bank.bankName || (typeof __donation_bank_name !== 'undefined' ? __donation_bank_name : ''));
      apply('accountName', bank.accountName || (typeof __donation_account_name !== 'undefined' ? __donation_account_name : ''));
      apply('accountNumber', bank.accountNumber || (typeof __donation_account_number !== 'undefined' ? __donation_account_number : ''));
      apply('swift', (typeof __donation_swift !== 'undefined' ? __donation_swift : ''));
      if (typeof __donation_note !== 'undefined') apply('note', __donation_note);
      renderQRIfProvided();
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        try { await signInAnonymously(auth); } catch {}
      }
      await loadBankDetails(user || auth.currentUser || null);
    });

    document.addEventListener('click', (e)=>{
      const copyBtn = e.target.closest('[data-copy]');
      if (copyBtn) {
        const id = copyBtn.getAttribute('data-copy');
        const el = els[id];
        const txt = el ? el.textContent.trim() : '';
        if (txt) navigator.clipboard.writeText(txt).then(()=> showToast('Copied')).catch(()=>{});
      }
    });
    document.getElementById('copyAllBtn')?.addEventListener('click', ()=>{
      const txt = `Bank: ${els.bankName?.textContent}\nAccount Name: ${els.accountName?.textContent}\nAccount Number: ${els.accountNumber?.textContent}\nSWIFT/IBAN: ${els.swift?.textContent}`;
      navigator.clipboard.writeText(txt).then(()=> showToast('All details copied')).catch(()=>{});
    });
    document.getElementById('shareBtn')?.addEventListener('click', ()=>{
      const text = `Support JCHAT\nBank: ${els.bankName?.textContent}\nAccount Name: ${els.accountName?.textContent}\nAccount Number: ${els.accountNumber?.textContent}\nSWIFT/IBAN: ${els.swift?.textContent}`;
      if (navigator.share) navigator.share({ text }).catch(()=>{}); else navigator.clipboard.writeText(text).then(()=> showToast('Share text copied')).catch(()=>{});
    });
  </script>
</body>
</html>